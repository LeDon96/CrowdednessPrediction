# CrowdednessPrediction

## Abstract
The aim of this research is to construct a model that predicts the crowdedness at selected spots within the city of Amsterdam, in the form of a time series. Historical data will be gathered from localized crowdedness measure points and will be combined with GVB data. The predictions with the given data will be made with both a multivariate regression model and a gradient boosted decision tree. The predicted crowdedness of both models will be visualized in separate time series over a given period of time. The two models will be compared in the evaluation based on the loss. 

## Link Thesis 
- [Overleaf](https://www.overleaf.com/3825517455cpkbjdbgpwmn)

## Contents
- [Log Book](Documents/LogBook.md)
- [Thesis Design](Documents/Thesis_Design_Crowdedness.pdf)

## Usage
- Clone or donwload the code
- Set the **Hyperparameter Settings** (See explanation below)
- Run [main.py](main.py)
- Enhoy the given prediciton :)

## Code
All the code can be run from the [main.py](main.py) file. This files calls on all the needed functions to do the following:
- [Import the datasets](Code/ImportData/constructFullDataset.py)
- [Construct models](Code/Models/models.py)
- [Generate Predictions](Code/Prediction/Prediction.py)

All the above steps need to be completed on the first run, afterwards, only step 3 needs to be done to generate the predictions. 

### Hyperparameter Settings
- [General Hyperparameters](ParamSettings/HParams.txt): In this file code spanning hyperparameter settings can be set. 
    - *Needed Sensors* (list): Which of the given sensors to include as ground truths in the prediction, given their data is present.
    - *gaww-02*/*gaww-03* (list): These include different names for the given sensors. This setting is specific to this project, due to data constraints and may be removed.
    - *stations* (list): Which stations to include as features for the predictions, given their data is present.
    - *make_fullDF* (boolean): If **True**, the full dataset needed to train the models is constructed. If **False**, it is assumed this dataset is already present.
    - *make_models* (boolean): if **True**, the predetermined models needed for prediction are constructed (see *reg_models* and *clas_models*). If **False**, it is assumed the models are laready constructed and present.
    - *gen_borders* (boolean): If **True**, the most outside Longitude and Latitude of the sensors present in the *Full Dataset* are saved. if **False**, the given parameters are used. 
    - *reg_models* (list): The regression models bound to the unique ID's present in this given list, are constructed in *make_models*.  
    - *clas_models* (list): The classification models bound to the unique ID's present in this given list, are constructed in *make_models*.
    - *lon_low", *lon_high*, *lat_low*, *lat_high* (float): These are the coordinate borders for any custom coordinates to make predictions for (interpolation). These settings can be generated by setting *gen_borders* to **True**. This is also used for the events to find borders within the events are relevant. 
- [Input File Locations](ParamSettings/InputFilePaths.txt): In this file, the paths to the input datafiles can be set.
    - *sensorData* (str): This file contains project specific ground truths of the crowdedness counts used in this project. Can be omitted from future use if file not present. 
    - *coordinateData* (str): This file contains the Longitude and Latitude of t=all the relevant sensors. 
    - *blipData* (str): This file contains project specific ground truths of the crowdedness counts used in this project, but in a more standardized format than *sensorData*. 
    - *arrData* (str): This file contains the number of passengers that arrive at each station.  
    - *deppData* (str): This file contains the number of passengers that depart at each station. 
    - *eventData* (str): This file contains the date and locations of all the events in Amsterdam. 
- [Output File Locations](ParamSettings/OutputFilePaths.txt): In this file, the paths to ouput files can be set. Default, a new dir is constructed for this, so no need to change these. 
    - *lon_scaler* (model): Scaler model used for the Longitude of the sensors.
    - *lat_scaler* (model): Scaler model used for the Latitude of the sensors.
    - *station_scaler* (model): Scaler model used for the RBF kernel between the coordinates of a given sensor and the station. 
    - *full_df* (str): Path location of where to save the full dataset. 
    - *average_passenger_counts* (str): Path location of where to save the average passenger counts per day, per station
    - *models* (str): Path to dir where all the scaler models are saved. 
    - *plots* (str): Path to dir where all the plots need to be saved. 
    - *reg_metrics* (str): Path to file where all the regression model results are saved.
    - *clas_metrics* (str): Path to file where all the classification model results are saved.
    - *rfg_model*, *xgbr_model*, *rfc_model*, *xgbc_model* (str): Where the saved prediction models should be saved. 
    - *predictions* (str): Map where all the generated predictions should be saved. 
- [Model Parameters](ParamSettings/ModelParams.txt): In this file, all the model specific settings can be edited. 
    - *trainTest* (float): Size of the train set
    - *KFold* (int): Number of cross-validations
    - *Unique model ID* (str):
        - *Name* (str): Full name of the model
        - *Score* (str): Main evaluation metric\
        - *visualization* (boolean): Whether to save the plots of the evaluation results
        - *cycles* (int): Number of cycles to do for Hyperparameter testing
        - *params* (dict): Which parameters to tune, with which options, during hyperparameter tuning
- [Prediction Parameters](ParamSettings/PredParams.txt): In this file, the parameters for generating predictions can be set. 
    - *model* (str): Which model to use, to generate the predictions.
    - *start_date* (str): Start date of the predictions, in the following format --> 'YYYY-MM-DD'.
    - *end_date* (str): End date of the predictions, in the following format --> 'YYYY-MM-DD'.
    - *add_sensors* (boolean): Whether to make predictions for the sensors used during the training of the model.
    - *extra_coordinate* (boolean): Whether to add a custom coordinate to the prediction, must be within the given lon, lat bounds set in **General Parameters**. 
        - *extra_lon*, *extra_lat*: The coordinates of the custom coordinate.
    - *make_plot* (boolean): Whether to plot the generate predictions. 

### Jupyter Test code
- [Jupyter Code](Jupyter%20Notebooks)